(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5416c207"],{"386d":function(t,e,n){"use strict";var a=n("cb7c"),r=n("83a1"),i=n("5f1b");n("214f")("search",1,(function(t,e,n,s){return[function(n){var a=t(this),r=void 0==n?void 0:n[e];return void 0!==r?r.call(n,a):new RegExp(n)[e](String(a))},function(t){var e=s(n,t,this);if(e.done)return e.value;var o=a(t),l=String(this),c=o.lastIndex;r(c,0)||(o.lastIndex=0);var u=i(o,l);return r(o.lastIndex,c)||(o.lastIndex=c),null===u?-1:u.index}]}))},7834:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-select",{staticClass:"form-control custom-form-control",attrs:{label:"name",filterable:!1,selectOnTab:!0,taggable:!0,options:t.landingsNames,placeholder:"Выберите отправление"},on:{search:t.onSearch,input:t.setNames},scopedSlots:t._u([{key:"option",fn:function(e){return[n("div",{staticClass:"d-center"},[t._v("\n      "+t._s(e.name)+"\n    ")])]}},{key:"selected-option",fn:function(e){return[n("div",{staticClass:"selected d-center"},[t._v("\n      "+t._s(e.name)+"\n    ")])]}}])},[n("template",{slot:"no-options"},[t._v("\n    Нет опций\n  ")])],2)},r=[],i=(n("7f7f"),n("96cf"),n("3b8d")),s=(n("386d"),n("365c")),o=n("cd50"),l=n.n(o),c={data:function(){return{landingsNames:[]}},methods:{onSearch:function(t,e){e(!0),this.search(e,t,this)},onSendRequest:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(""===e){t.next=8;break}return t.next=3,s["p"].getLandings("?name="+e);case 3:n=t.sent,a=n.data,this.landingsNames=a["hydra:member"],t.next=9;break;case 8:this.landingsNames=[];case 9:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),search:l()((function(t,e,n){n.onSendRequest(e),t(!1)}),1e3),setNames:function(t){null!==t&&this.$emit("getLandingFrom",{id:t.id,name:"landingFrom",value:t.name})}}},u=c,m=n("2877"),d=Object(m["a"])(u,a,r,!1,null,null,null);e["a"]=d.exports},"83a1":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},8541:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"flights"}},[n("div",[n("b-card",[n("b-row",{attrs:{"no-gutters":""}},[n("b-col",{attrs:{cols:"12",md:"auto"}},[n("v-date-picker",{attrs:{attributes:t.attributes,"input-props":{class:"form-control",placeholder:"Выберите дату"},popover:{visibility:"click"}},on:{input:function(e){return t.fetchDataNew("simple")}},model:{value:t.myDate,callback:function(e){t.myDate=e},expression:"myDate"}})],1),t.roleDriver?t._e():n("b-col",[n("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle.collapse-legend",modifiers:{"collapse-legend":!0}},{name:"b-tooltip",rawName:"v-b-tooltip.hover.bottom",value:"Расширенный поиск",expression:"'Расширенный поиск'",modifiers:{hover:!0,bottom:!0}}],staticClass:"mr-1 ml-1",attrs:{variant:"light"}},[n("i",{staticClass:"fas fa-angle-double-down"})]),t.roleExternalCashier?t._e():n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.bottom",value:"Календарь",expression:"'Календарь'",modifiers:{hover:!0,bottom:!0}}],attrs:{to:"/calendar",variant:"light"}},[n("i",{staticClass:"far fa-calendar-alt"})])],1)],1),n("div",[n("b-collapse",{staticClass:"mt-2",attrs:{id:"collapse-legend"},model:{value:t.visibleCollapse,callback:function(e){t.visibleCollapse=e},expression:"visibleCollapse"}},[n("b-card",[n("b-card-text",[n("b-row",[n("b-col",{attrs:{lg:"7"}},[n("b-form",[n("b-form-group",[n("b-row",[n("b-col",[n("b-form-input",{attrs:{placeholder:"Поиск по маршруту"},model:{value:t.routeInput,callback:function(e){t.routeInput=e},expression:"routeInput"}})],1),n("b-col",[n("b-form-input",{attrs:{placeholder:"Поиск по рейсу"},model:{value:t.tractInput,callback:function(e){t.tractInput=e},expression:"tractInput"}})],1),n("b-col",[n("v-select",{staticClass:"form-control custom-form-control",attrs:{options:t.directionOptions,label:"name",placeholder:"Поиск по направлению"},model:{value:t.directionInput,callback:function(e){t.directionInput=e},expression:"directionInput"}},[n("template",{slot:"no-options"},[t._v("\n                              Нет опций\n                            ")])],2)],1)],1)],1),n("b-form-group",[n("b-row",[n("b-col",[n("select-landings-from",{key:t.componentKey,on:{getLandingFrom:t.getData}})],1),n("b-col",[n("select-landings-to",{key:t.componentKey,on:{getLandingTo:t.getData}})],1),n("b-col",[n("b-form-select",{attrs:{options:t.activeType,placeholder:"Поиск по активности"},model:{value:t.activeStatusInput,callback:function(e){t.activeStatusInput=e},expression:"activeStatusInput"}})],1)],1)],1)],1)],1),n("b-col",{attrs:{lg:"5"}},[n("b-form",[n("b-form-group",[n("b-row",[n("b-col",[n("v-date-picker",{attrs:{attributes:t.attributes,"input-props":{placeholder:"Выберите период"},popover:{visibility:"click"},mode:"range"},model:{value:t.range,callback:function(e){t.range=e},expression:"range"}})],1)],1)],1),n("b-form-group",[n("b-row",[n("b-col",[n("b-button",{attrs:{size:"sm",variant:"danger"},on:{click:function(e){return t.reset()}}},[t._v("\n                            Сбросить\n                          ")]),n("b-button",{attrs:{size:"sm",variant:"primary ml-2"},on:{click:function(e){return t.fetchDataNew("range")}}},[t._v("\n                            Поиск\n                          ")])],1)],1)],1)],1)],1)],1)],1)],1)],1)],1),n("b-table",{staticClass:"sale-custom-table",attrs:{busy:t.isBusy,fields:t.fields,items:t.items,responsive:"",small:""},on:{"row-clicked":t.edit},scopedSlots:t._u([{key:"cell(vehicle.specifications)",fn:function(e){return[t._v("\n          "+t._s(e.value.regNumber)+"\n        ")]}},{key:"cell(name)",fn:function(e){return[n("b",{staticClass:"text-info"},[t._v(t._s(e.item.name)+" ")])]}},{key:"table-busy",fn:function(){return[n("div",{staticClass:"text-center text-danger my-2"},[n("b-button",{attrs:{disabled:"",variant:"secondary"}},[n("b-spinner",{attrs:{small:""}}),t._v("\n              Загрузка...\n            ")],1)],1)]},proxy:!0},t.roleExternalCashier||t.roleDriver?null:{key:"cell(actions)",fn:function(e){return[n("b-button-group",[201===e.item.state?n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.bottom",value:"Открыть рейс",expression:"'Открыть рейс'",modifiers:{hover:!0,bottom:!0}}],attrs:{size:"sm",variant:"light"},on:{click:function(n){return t.changeState(e,200)}}},[n("i",{staticClass:"fas fa-lock"})]):t._e(),200===e.item.state?n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.bottom",value:"Закрыть рейс",expression:"'Закрыть рейс'",modifiers:{hover:!0,bottom:!0}}],attrs:{size:"sm",variant:"light"},on:{click:function(n){return t.changeState(e,201)}}},[n("i",{staticClass:"fas fa-lock-open"})]):t._e()],1)]}},t.roleExternalCashier?null:{key:"cell(print)",fn:function(e){return[n("div",[n("b-button-toolbar",{attrs:{"aria-label":"Toolbar with button group"}},[n("b-button-group",{staticClass:"mx-1",attrs:{size:"sm"}},[n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.bottom",value:"Печать ведомости",expression:"'Печать ведомости'",modifiers:{hover:!0,bottom:!0}}],attrs:{variant:"outline-secondary"},on:{click:function(n){return t.printReport(e.item,1)}}},[t._v("П\n                ")]),n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.bottom",value:"Печать ведомости",expression:"'Печать ведомости'",modifiers:{hover:!0,bottom:!0}}],attrs:{variant:"outline-secondary"},on:{click:function(n){return t.printReport(e.item,2)}}},[t._v("БП\n                ")]),t.roleDriver?t._e():n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.bottom",value:"Печать ведомости",expression:"'Печать ведомости'",modifiers:{hover:!0,bottom:!0}}],attrs:{variant:"outline-secondary"},on:{click:function(n){return t.printReport(e.item,3)}}},[t._v("36\n                ")]),t.roleDriver?t._e():n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.bottom",value:"Печать ведомости",expression:"'Печать ведомости'",modifiers:{hover:!0,bottom:!0}}],attrs:{variant:"outline-secondary"},on:{click:function(n){return t.printReport(e.item,4)}}},[t._v("36П\n                ")])],1)],1)],1)]}},{key:"cell(state)",fn:function(e){return[200===e.item.state?n("h6",[n("b-badge",{attrs:{variant:"success"}},[t._v("Открыт\n            ")])],1):t._e(),201===e.item.state?n("h6",[n("b-badge",{attrs:{variant:"danger"}},[t._v("Закрыт\n            ")])],1):t._e(),203===e.item.state?n("h6",[n("b-badge",{attrs:{variant:"dark"}},[t._v("Отменен\n            ")])],1):t._e(),202===e.item.state?n("h6",[n("b-badge",{attrs:{variant:"secondary"}},[t._v("Выполнен\n            ")])],1):t._e()]}},{key:"row-details",fn:function(e){return[n("b-container",[n("b-card",{attrs:{header:e.item.name,align:"center","border-variant":"secondary","header-bg-variant":"secondary","header-text-variant":"white"}},[n("b-table",{attrs:{fields:t.fieldsDetails,items:[e.item],align:"center",stacked:""},scopedSlots:t._u([{key:"cell(vehicle.specifications)",fn:function(e){return[t._v("\n                  "+t._s(e.value.modelBus)+","+t._s(e.value.regNumber)+"\n                ")]}}],null,!0)})],1)],1)]}}],null,!0)}),t.items.length>29||1!==t.currentPage?n("b-pagination",{attrs:{"per-page":t.perPage,"total-rows":t.totalItems,align:"center","aria-controls":"my-table"},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}}):t._e()],1)],1)])},r=[],i=(n("7f7f"),n("96cf"),n("3b8d")),s=n("365c"),o=n("a612"),l=n("7834"),c=n("887e"),u={mixins:[c["a"]],data:function(){var t=this;return{attributes:[{highlight:"green",dates:new Date}],activeStatusInput:"",activeType:[{value:"",text:"Активные"},{value:"&show_all=true",text:"Все"}],directionOptions:[],visibleCollapse:!1,mode:null,myDate:new Date,routeInput:"",tractInput:"",landingFromInput:"",landingToInput:"",directionInput:"",componentKey:0,perPage:30,currentPage:1,totalItems:0,isBusy:!0,range:null,fields:[{key:"name",label:"Рейс",sortable:!0},{key:"dateStart",label:"Дата и время",sortable:!0,formatter:function(e,n,a){return t.$moment(e).format("DD.MM.YYYY HH:mm")}},{key:"vehicle.specifications",label:"ТС",sortable:!0},{key:"freePlaceCount",class:"text-center",sortable:!0,label:"Свободно"},{key:"state",class:"text-center",label:"Статус рейса",sortable:!0},{key:"actions",label:"Действия"},{key:"print",label:"Ведомости"}],fieldsDetails:[{key:"name",label:"Рейс"},{key:"dateStart",label:"Дата и время",sortable:!0,formatter:function(e,n,a){return t.$moment(e).format("DD.MM.YYYY")}},{key:"vehicle.specifications",label:"ТС"}],fieldsDetailsLandings:[{key:"index",label:"Номер"},{key:"name",label:"Пункт"},{key:"departTime",label:"Время отправления"}],items:[]}},components:{selectLandingsFrom:l["a"],selectLandingsTo:o["a"]},mounted:function(){var t;this.setBreadCrumbs(),sessionStorage.getItem("RangeValue")?(t=JSON.parse(sessionStorage.getItem("RangeValue")),this.tractInput=t.tract,this.routeInput=t.route,this.directionInput=t.direction,this.landingFromInput=t.landFrom,this.landingToInput=t.landTo,t.range&&(this.range={start:new Date(t.range.start),end:new Date(t.range.end)}),this.fetchDataNew("range"),this.myDate=null,this.visibleCollapse=!0):sessionStorage.getItem("SimpleValue")&&(t=JSON.parse(sessionStorage.getItem("SimpleValue")),this.myDate=new Date(t)),sessionStorage.clear()},methods:{setBreadCrumbs:function(){this.$store.dispatch("breadcrumbs/getBreadCrumbs",{title:"Продажи"})},fetchDataNew:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var n,a,r,i,o,l,c,u,m,d,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!==this.myDate){t.next=3;break}return this.myDate=new Date,t.abrupt("return");case 3:this.isBusy=!0,n="",a="",r="",i="",o="",l="",c="",t.t0=e,t.next="simple"===t.t0?8:"range"===t.t0?12:21;break;case 8:return this.mode="simple",a="&date_start="+this.$moment(this.myDate).format("YYYY-MM-DD"),n="&date_finish="+this.$moment(this.myDate).format("YYYY-MM-DD"),t.abrupt("break",21);case 12:return this.mode="range",l=""!==this.directionInput?"&direction="+this.directionInput.name:"",r=""!==this.tractInput?"&name="+this.tractInput:"",i=""!==this.routeInput?"&route_name="+this.routeInput:"",o=""!==this.landingFromInput?"&start_landing="+this.landingFromInput:"",c=""!==this.landingToInput?"&end_landing="+this.landingToInput:"",a=null!==this.range?"&date_start="+this.$moment(this.range.start).format("YYYY-MM-DD"):"",n=null!==this.range?"&date_finish="+this.$moment(this.range.end).format("YYYY-MM-DD"):"",t.abrupt("break",21);case 21:return t.prev=21,t.next=24,s["G"].getTractsCustomFilters("?page="+this.currentPage+r+i+o+c+a+n+l+this.activeStatusInput);case 24:for(u=t.sent,m=u.data,d=0;d<m["hydra:member"].length;d++)0==m["hydra:member"][d].freePlaceCount?m["hydra:member"][d]._rowVariant="danger":m["hydra:member"][d].freePlaceCount>0&&m["hydra:member"][d].freePlaceCount<6&&(m["hydra:member"][d]._rowVariant="warning");return this.items=m["hydra:member"],this.totalItems=m["hydra:totalItems"],t.next=31,s["j"].getDirections("");case 31:p=t.sent,this.directionOptions=p.data["hydra:member"].map((function(t){return{value:t.id,name:t.name}})),this.isBusy=!this.isBusy,t.next=39;break;case 36:t.prev=36,t.t1=t["catch"](21),console.log("Ошибка:",t.t1);case 39:case"end":return t.stop()}}),t,this,[[21,36]])})));function e(e){return t.apply(this,arguments)}return e}(),getData:function(t){"landingFrom"===t.name?this.landingFromInput=t.value:this.landingToInput=t.value},edit:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.roleDriver){t.next=2;break}return t.abrupt("return");case 2:return this.saveToStorage(),t.next=5,this.$router.push({name:"tractSalesSale",params:{id:e.id}});case 5:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),saveToStorage:function(){"range"===this.mode?sessionStorage.setItem("RangeValue",JSON.stringify({tract:this.tractInput,route:this.routeInput,landFrom:this.landingFromInput,landTo:this.landingToInput,range:this.range,direction:this.directionInput})):"simple"===this.mode&&sessionStorage.setItem("SimpleValue",JSON.stringify(this.myDate))},changeState:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,n){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={state:n,id:e.item.id},t.prev=1,t.next=4,s["G"].postChangeTractState(a);case 4:this.items[e.index].state=n,this.infoSuccess("Статус рейса изменен успешно"),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),console.log(t.t0);case 11:case"end":return t.stop()}}),t,this,[[1,8]])})));function e(e,n){return t.apply(this,arguments)}return e}(),printReport:function(t,e){switch(e){case 1:this.saveToStorage();var n=this.$router.resolve({name:"saleTractPlace",params:{id:t.id}});window.open(n.href,"_blank");break;case 2:this.saveToStorage();var a=this.$router.resolve({name:"saleSoldedPlace",params:{id:t.id}});window.open(a.href,"_blank");break;case 3:this.saveToStorage();var r=this.$router.resolve({name:"saleReport36",params:{id:t.id}});window.open(r.href,"_blank");break;case 4:this.saveToStorage();var i=this.$router.resolve({name:"saleReport36P",params:{id:t.id}});window.open(i.href,"_blank");break}},reset:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.activeStatusInput="",this.routeInput="",this.tractInput="",this.directionInput="",this.landingFromInput="",this.landingToInput="",this.range=null,this.currentPage=1,this.componentKey+=1,this.fetchDataNew("simple");case 10:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),infoSuccess:function(t){this.$toast.success(t)}},watch:{currentPage:function(){this.fetchDataNew(this.mode)}}},m=u,d=n("2877"),p=Object(d["a"])(m,a,r,!1,null,null,null);e["default"]=p.exports},a612:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-select",{staticClass:"form-control custom-form-control",attrs:{label:"name",filterable:!1,selectOnTab:!0,taggable:!0,options:t.landingsNames,placeholder:"Выберите назначение"},on:{search:t.onSearch,input:t.setNames},scopedSlots:t._u([{key:"option",fn:function(e){return[n("div",{staticClass:"d-center"},[t._v("\n      "+t._s(e.name)+"\n    ")])]}},{key:"selected-option",fn:function(e){return[n("div",{staticClass:"selected d-center"},[t._v("\n      "+t._s(e.name)+"\n    ")])]}}])},[n("template",{slot:"no-options"},[t._v("\n    Нет опций\n  ")])],2)},r=[],i=(n("7f7f"),n("96cf"),n("3b8d")),s=(n("386d"),n("365c")),o=n("cd50"),l=n.n(o),c={data:function(){return{landingsNames:[]}},methods:{onSearch:function(t,e){e(!0),this.search(e,t,this)},onSendRequest:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(""===e){t.next=8;break}return t.next=3,s["p"].getLandings("?name="+e);case 3:n=t.sent,a=n.data,this.landingsNames=a["hydra:member"],t.next=9;break;case 8:this.landingsNames=[];case 9:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),search:l()((function(t,e,n){n.onSendRequest(e),t(!1)}),1e3),setNames:function(t){null!==t&&this.$emit("getLandingTo",{id:t.id,name:"landingTo",value:t.name})}}},u=c,m=n("2877"),d=Object(m["a"])(u,a,r,!1,null,null,null);e["a"]=d.exports},cd50:function(t,e){t.exports=function(t,e){var n=null;return function(){clearTimeout(n);var a=arguments,r=this;n=setTimeout((function(){t.apply(r,a)}),e)}}}}]);